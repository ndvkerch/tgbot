from aiogram import Router, types
from aiogram.filters import Command
from keyboards import get_main_keyboard  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
from database import get_user, add_or_update_user  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

start_router = Router()

@start_router.message(Command("start"))
async def start_command(message: types.Message):
    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É (–µ—Å–ª–∏ –±—ã–ª–∞) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    await message.answer("‚è≥ –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É...", reply_markup=types.ReplyKeyboardRemove())

    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω –µ—â—ë –Ω–µ –≤ –±–∞–∑–µ
    user_id = message.from_user.id
    user = get_user(user_id)
    if not user:
        add_or_update_user(
            user_id=user_id,
            first_name=message.from_user.first_name,
            last_name=message.from_user.last_name,
            username=message.from_user.username
        )

    # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    welcome_text = (
        "üëã –ü—Ä–∏–≤–µ—Ç, {name}!\n\n"
        "–Ø ‚Äì –±–æ—Ç –ø—Ä–æ–µ–∫—Ç–∞ *–Ø –Ω–∞ —Å–ø–æ—Ç–µ* üèÑ‚Äç‚ôÇÔ∏èüå¨Ô∏è\n\n"
        "üìç *–ü–æ–º–æ–≥—É —Ç–µ–±–µ —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–∞–ª–∫—É –Ω–∞ –∫–∞–π—Ç–µ!* \n\n"
        "‚úÖ –ü–æ–∫–∞–∂—É –±–ª–∏–∂–∞–π—à–∏–µ –∫ —Ç–µ–±–µ —Å–ø–æ—Ç—ã —Å –ø–æ–¥—Ö–æ–¥—è—â–∏–º –≤–µ—Ç—Ä–æ–º üå¨Ô∏è\n"
        "‚úÖ –†–∞—Å—Å–∫–∞–∂—É, –≥–¥–µ —É–∂–µ –∑–∞—á–µ–∫–∏–Ω–∏–ª–∏—Å—å –∫–∞–π—Ç–µ—Ä—ã –∏–ª–∏ –∫—Ç–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è üöÄ\n"
        "‚úÖ –î–∞–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Å–ø–æ—Ç–∞–º ‚òÄÔ∏èüåä\n"
        "‚úÖ –ü–æ–∑–≤–æ–ª—é –æ—Ç–º–µ—á–∞—Ç—å —Å–≤–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –≤–∏–¥–µ—Ç—å –¥—Ä—É–≥–∏—Ö –∫–∞–π—Ç—Å–µ—Ä—Ñ–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ üó∫Ô∏è\n\n"
        "üì≤ –í—ã–±–∏—Ä–∞–π –∫–æ–º–∞–Ω–¥—É –Ω–∏–∂–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏ –º–Ω–µ!"
    ).format(name=message.from_user.full_name)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
    await message.answer(welcome_text, parse_mode="Markdown", reply_markup=get_main_keyboard(user_id))